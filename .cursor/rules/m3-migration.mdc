---
description: M3 migration boundaries – import rules and style conventions for M3 routes
globs: src/app/(app)/(main)/**/*
alwaysApply: false
---

# M3 Migration Rules

## Scope

- **M3 (main app)**: Routes under `(app)/(main)/` serve `/`, `/exercises`, `/workout-plans`, etc.; components under `(main)/_components/` or `(main)/_ui/`; only `m3.css` tokens (`--m3-*`, `.m3-*`).
- **Legacy**: Routes under `(app)/legacy/workout-plan/` serve `/legacy/workout-plan`, `/legacy/workout-plan/exercises`, etc.; components under `components/`; may use globals.css tokens and legacy patterns.

## Import Boundaries (M3 routes)

### Forbidden imports

M3 routes and M3 components **must not** import:

- `@/components/layout/*`
- `@/components/navigation/*` (TopNavigation, BottomNavigation, PageHeader from legacy)
- `@/components/exercises/*` (ExerciseCard, ExercisesList, ExerciseFilters, ExerciseSort, AddExerciseButton, DeleteExerciseDialog)
- `@/components/workout-plans/*`, `@/components/workout-sessions/*`, `@/components/personal-records/*`
- `@/components/shared/empty-state` (use `(main)/_components/EmptyState` instead)

### Allowed imports

M3 routes may import:

- `@/components/ui/*` (shadcn primitives)
- `(main)/_components/*`, `(main)/_ui/*` (relative or from app)
- `@/services/*`, `@/hooks/*`, `@/lib/*`, `@/types`

## Style Conventions (M3)

- **No legacy Tailwind classes**: Avoid `bg-secondary`, `text-zinc-*`, `dark:bg-zinc-*`, `rounded-2xl`, `border-border` in M3 components.
- **Use M3 tokens**: Prefer `var(--m3-*)`, `.m3-headline`, `.m3-label`, `.m3-cta`, `.m3-chip`.
- **Links**: M3 internal links use main paths: `/`, `/exercises/new`, `/exercises/[id]`, `/workout-plans`, etc. Legacy is under `/legacy/workout-plan/*`.

## Shadcn Purity

Components in `src/components/ui/` must remain **clean** – no hardcoded legacy colors, `dark:` overrides, or legacy classes. M3 styling is applied via:

1. **m3.css** – overrides CSS vars (`--background`, `--primary`, etc.) under `.ui-m3`
2. **M3 wrappers** – add `.m3-*` classes to shadcn primitives when needed
